(()=>{"use strict";function t(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",e),t.removeEventListener("click",n)}function e(e){"Escape"===e.key&&t(document.querySelector(".popup_is-opened"))}function n(e){e.currentTarget===e.target&&t(e.target)}function o(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",e),t.addEventListener("click",n)}function r(){return fetch("https://nomoreparties.co/v1/wff-cohort-27/users/me",{method:"GET",headers:{authorization:"1df3e0b5-5f50-4a81-8676-1c3377736101"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}function c(t,e,n){var o=document.querySelector("#card-template").content.querySelector(".places__item").cloneNode(!0),r=o.querySelector(".card__delete-button"),c=o.querySelector(".card__like-button"),a=o.querySelector(".card-like-count"),i=o.querySelector(".card-like-count");return o.querySelector(".card__image").setAttribute("src",t.link),o.querySelector(".card__image").setAttribute("alt",t.name),o.querySelector(".card__title").textContent=t.name,a.textContent=t.likes.length,t.likes.forEach((function(t){t._id===n&&c.classList.add("card__like-button_is-active")})),c.addEventListener("click",(function(e){!function(t,e,n,o){var r;e.classList.contains("card__like-button_is-active")?(r=n,fetch("https://nomoreparties.co/v1/wff-cohort-27/cards/likes/".concat(r),{method:"DELETE",headers:{authorization:"1df3e0b5-5f50-4a81-8676-1c3377736101","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(e){t.target.classList.toggle("card__like-button_is-active"),o.textContent=e.likes.length})):function(t){return fetch("https://nomoreparties.co/v1/wff-cohort-27/cards/likes/".concat(t),{method:"PUT",headers:{authorization:"1df3e0b5-5f50-4a81-8676-1c3377736101","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(n).then((function(e){t.target.classList.toggle("card__like-button_is-active"),o.textContent=e.likes.length}))}(e,c,t._id,i)})),n===t.owner._id?r.addEventListener("click",(function(){!function(t,e){(function(t){fetch("https://nomoreparties.co/v1/wff-cohort-27/cards/".concat(t),{method:"DELETE",headers:{authorization:"1df3e0b5-5f50-4a81-8676-1c3377736101","Content-Type":"application/json"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))})(e),t.remove()}(o,t._id)})):r.classList.add("card__delete-button-inactive"),o.querySelector(".card__image").addEventListener("click",e),o}function a(t,e){!0===t.some((function(t){return!t.validity.valid}))?e.classList.add("popup__button_disabled"):e.classList.remove("popup__button_disabled")}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}var u=document.querySelector(".places__list"),s=document.querySelector(".popup__input_type_card-name"),l=document.querySelector(".popup__input_type_url"),p=document.querySelector(".profile__add-button"),d=document.querySelectorAll(".popup__close"),f=document.querySelector(".profile__edit-button"),_=document.querySelector(".popup_type_new-card"),m=document.querySelector(".popup_type_new-avatar"),y=document.querySelector(".popup_type_edit"),v=document.forms["edit-profile"],h=document.forms["new-place"],b=document.querySelector(".popup__input_type_name"),S=document.querySelector(".popup__input_type_description"),g=document.querySelector(".popup__image"),q=document.querySelector(".popup_type_image"),k=document.querySelector(".popup__caption"),L=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),C=document.querySelector(".profile__image-edit-button"),j=document.forms["new-avatar"],x=j.elements.link,A=document.querySelector(".profile__image"),w="";function T(t){k.textContent=t.target.alt,g.src=t.target.src,g.alt=t.target.alt,t.target.classList.contains("card__image")&&o(q)}d.forEach((function(e){e.addEventListener("click",(function(){var n=e.closest(".popup_is-opened");t(n),e.classList.contains("popup__button")&&function(t){t.querySelectorAll(".popup__input").forEach((function(e){var n=t.querySelector(".".concat(e.id,"-error"));n.classList.remove("popup__input_error"),n.textContent=""}));var e=t.querySelector(".popup__button");console.log(t),e.classList.remove("popup__button_disabled")}(n)}))})),p.addEventListener("click",(function(){h.setAttribute("novalidate",""),o(_)})),C.addEventListener("click",(function(){h.setAttribute("novalidate",""),o(m)})),f.addEventListener("click",(function(){v.setAttribute("novalidate",""),b.value=L.textContent,S.value=E.textContent,o(y)})),v.addEventListener("submit",(function(e){e.preventDefault();var n,o,r=S.value,c=b.value,a=v.querySelector(".popup__button");a.textContent="Сохранение...",(n=c,o=r,fetch("https://nomoreparties.co/v1/wff-cohort-27/users/me",{method:"PATCH",headers:{authorization:"1df3e0b5-5f50-4a81-8676-1c3377736101","Content-Type":"application/json"},body:JSON.stringify({name:n,about:o})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(){L.textContent=c,E.textContent=r,t(y)})).catch((function(t){console.log(t)})).finally((function(){a.textContent="Сохранить"}))})),h.addEventListener("submit",(function(e){e.preventDefault();var n=s.value,o=l.value,a=h.querySelector(".popup__button");a.textContent="Сохранение...";var i,p,d=r().then((function(t){return t._id})).catch((function(t){console.log(t)}));(i=n,p=o,fetch("https://nomoreparties.co/v1/wff-cohort-27/cards ",{method:"POST",headers:{authorization:"1df3e0b5-5f50-4a81-8676-1c3377736101","Content-Type":"application/json"},body:JSON.stringify({name:i,link:p})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(e){var n=c(e,T,d);u.prepend(n),h.reset(),t(_)})).catch((function(t){console.log(t)})).finally((function(){a.textContent="Сохранить"}))})),j.addEventListener("submit",(function(e){e.preventDefault();var n,o=j.querySelector(".popup__button");o.textContent="Сохранение...",(n=x.value,fetch("https://nomoreparties.co/v1/wff-cohort-27/users/me/avatar",{method:"PATCH",headers:{authorization:"1df3e0b5-5f50-4a81-8676-1c3377736101","Content-Type":"application/json"},body:JSON.stringify({avatar:n})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(e){A.style.backgroundImage="url(".concat(e.avatar,")"),t(m),x.value=""})).catch((function(t){console.log(t)})).finally((function(){o.textContent="Сохранить"}))})),Array.from(document.querySelectorAll(".popup__form")).forEach((function(t){var e,n,o;t.addEventListener("submit",(function(t){t.preventDefault()})),e=t,n=Array.from(e.querySelectorAll(".popup__input")),o=e.querySelector(".popup__button"),n.forEach((function(t){t.addEventListener("input",(function(){!function(t,e,n){!1===/[-а-яa-z\sё]+$/i.test(t.value)&&!1===t.classList.contains("popup__input_type_url")&&t.value.length>1?(t.setCustomValidity(t.dataset.errorMessage),a(n,e)):(t.setCustomValidity(""),a(n,e)),!1===t.validity.valid?(function(t,e){var n=document.querySelector(".".concat(t.id,"-error"));n.textContent=e,n.classList.add("popup__input_error")}(t,t.validationMessage),a(n,e)):(function(t){var e=document.querySelector(".".concat(t.id,"-error"));e.classList.remove("popup__input_error"),e.textContent=""}(t),a(n,e))}(t,o,n)}))}))}));var P=[r(),fetch("https://nomoreparties.co/v1/wff-cohort-27/cards",{headers:{authorization:"1df3e0b5-5f50-4a81-8676-1c3377736101",method:"GET"}}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))];Promise.all(P).then((function(t){var e,n,o=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c,a,i=[],u=!0,s=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=c.call(n)).done)&&(i.push(o.value),i.length!==e);u=!0);}catch(t){s=!0,r=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw r}}return i}}(e,n)||function(t,e){if(t){if("string"==typeof t)return i(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0],a=o[1];L.textContent=r.name,E.textContent=r.about,A.style.backgroundImage="url(".concat(r.avatar,")"),w=r._id,a.forEach((function(t){var e=c(t,T,w);u.append(e)}))}))})();